# ===================================
# A股自选股智能分析系统 - Docker Compose
# ===================================
# 一键启动，自动管理容器生命周期

version: '3.8'

services:
  stock-analyzer:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: stock-analyzer
    restart: unless-stopped
    
    # 端口映射（Web 界面）
    ports:
      - "8000:8000"
    
    # 环境变量（从 .env 文件加载）
    env_file:
      - .env
    
    # 挂载卷（持久化数据）
    volumes:
      - ./data:/app/data          # 数据库
      - ./logs:/app/logs          # 日志文件
      - ./reports:/app/reports    # 分析报告
    
    # 网络设置
    environment:
      - TZ=Asia/Shanghai
      # 代理设置建议移至 .env 文件，此处仅保留时区
    
    # 日志配置
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    
    # 资源限制
    deploy:
      resources:
        limits:
          memory: 1G
        reservations:
          memory: 256M

# 如果需要网络隔离，可以定义网络
# networks:
#   stock-net:
#     driver: bridge
